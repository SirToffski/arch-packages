From: Ryan Williams <git@ryan.nz>
Date: Thu Dec  2 10:53:21 2021
Subject: [PATCH] Allow forcing vsync on or off using the config

---
 alacritty.yml                   | 3 +++
 alacritty/src/config/window.rs  | 4 ++++
 alacritty/src/display/window.rs | 6 ++++--
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/alacritty.yml b/alacritty.yml
index 8f4f5218e..e74f59a5d 100644
--- a/alacritty.yml
+++ b/alacritty.yml
@@ -93,6 +93,9 @@
   # and `light`. Set this to `None` to use the default theme variant.
   #gtk_theme_variant: None
 
+  # Force window vsync on or off
+  #vsync: true
+
 #scrolling:
   # Maximum number of lines in the scrollback buffer.
   # Specifying '0' will disable scrolling.
diff --git a/alacritty/src/config/window.rs b/alacritty/src/config/window.rs
index d74390d88..f0b05e2fd 100644
--- a/alacritty/src/config/window.rs
+++ b/alacritty/src/config/window.rs
@@ -45,6 +45,9 @@ pub struct WindowConfig {
     /// Window class.
     pub class: Class,
 
+    /// Window vsync
+    pub vsync: Option<bool>,
+
     /// Pixel padding.
     padding: Delta<u8>,
 
index e75698f..a4f8336 100644
--- a/alacritty/src/config/window.rs
+++ b/alacritty/src/config/window.rs
@@ -70,6 +70,7 @@ impl Default for WindowConfig {
             gtk_theme_variant: Default::default(),
             dynamic_padding: Default::default(),
             class: Default::default(),
+            vsync: Default::default(),
             opacity: Default::default(),
             padding: Default::default(),
             dimensions: Default::default(),
diff --git a/alacritty/src/display/window.rs b/alacritty/src/display/window.rs
index 7302c6877..39f87f781 100644
--- a/alacritty/src/display/window.rs
+++ b/alacritty/src/display/window.rs
@@ -185,10 +185,12 @@ impl Window {
         #[cfg(any(not(feature = "wayland"), target_os = "macos", windows))]
         let is_wayland = false;
 
+        let enable_vsync = window_config.vsync.unwrap_or(!is_wayland);
+
         let windowed_context =
-            create_gl_window(window_builder.clone(), event_loop, false, !is_wayland, size)
+            create_gl_window(window_builder.clone(), event_loop, true, enable_vsync, size)
                 .or_else(|_| {
-                    create_gl_window(window_builder, event_loop, true, !is_wayland, size)
+                    create_gl_window(window_builder, event_loop, true, enable_vsync, size)
                 })?;
 
         // Text cursor.
 
