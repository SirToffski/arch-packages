pkgname=libclc12+clang
pkgver=13.0.0
pkgrel=1
pkgdesc="Library requirements of the OpenCL C programming language"
arch=('any')
provides=('libclc' "libclc=${pkgver}")
conflicts=('libclc')
url="https://libclc.llvm.org/"
license=('MIT')
makedepends=('clang' 'llvm' 'cmake' 'ninja' 'python' 'git'
  'spirv-llvm-translator')

_gitcommit="d7b669b3a30345cfcdb2fde2af6f48aa4b94845d"
source=(
  "llvm-project::git+https://github.com/llvm/llvm-project.git#commit=${_gitcommit}"
)

sha256sums=('SKIP')

prepare() {

  cd "${srcdir:?}/llvm-project/libclc" || (
    echo -e "\E[1;31mCan't cd to ${srcdir}/llvm-project/libclc directory! Prepare Failed! \E[0m"
    exit 1
  )

  mkdir -p build

}

build() {

  cd "${srcdir:?}/llvm-project/libclc/build" || (
    echo -e "\E[1;31mCan't cd to ${srcdir}/llvm-project/libclc/build directory! Build Failed! \E[0m"
    exit 1
  )

  cmake .. -G Ninja \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr
  ninja

}

package() {

  cd "${srcdir:?}/llvm-project/libclc/build" || (
    echo -e "\E[1;31mCan't cd to ${srcdir}/llvm-project/libclc/build directory! Package Failed! \E[0m"
    exit 1
  )

  DESTDIR="${pkgdir:?}" ninja install
  install -Dm644 ../LICENSE.TXT "${pkgdir:?}/usr/share/licenses/${pkgname}/LICENSE"

}
