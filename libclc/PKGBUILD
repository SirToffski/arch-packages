pkgname=libclc12+clang
pkgver=13.0.1
pkgrel=1
pkgdesc="Library requirements of the OpenCL C programming language"
arch=('any')
provides=('libclc' "libclc=${pkgver}")
conflicts=('libclc')
url="https://libclc.llvm.org/"
license=('MIT')
makedepends=('clang' 'llvm' 'cmake' 'python' 'git' 'spirv-llvm-translator')

_commit=75e33f71c2dae584b13a7d1186ae0a038ba98838
source=(
  "llvm-project::git+https://github.com/llvm/llvm-project.git#commit=${_commit}"
)

sha256sums=('SKIP')

build() {

  cmake -B build -S "${srcdir:?}/llvm-project/libclc" \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr

  cmake --build build

}

package() {

  DESTDIR="${pkgdir:?}" cmake --install build
  install -Dm644 "${srcdir:?}/llvm-project/libclc/LICENSE.TXT" "${pkgdir:?}/usr/share/licenses/${pkgname}/LICENSE"

}
