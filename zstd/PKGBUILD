pkgname=zstd-noname
pkgver=1.5.0
pkgrel=1
pkgdesc='Zstandard - Fast real-time compression algorithm'
url='https://facebook.github.io/zstd/'
arch=(x86_64)
license=(BSD GPL2)
depends=(glibc gcc-libs zlib xz lz4)
makedepends=(gtest)
provides=('zstd' 'libzstd.so')
conflicts=('zstd')
source=("https://github.com/facebook/zstd/releases/download/v${pkgver}/zstd-${pkgver}.tar.zst"{,.sig})

sha256sums=('9aa8dfc1ca17f358b28988ca1f6e00ffe1c6f3198853f8d2022799e6f0669180'
            'SKIP')
b2sums=('cfea18b2347bf893d9bd461e57113d0a141040a1f7a42db6221ed9662f84023f45b058df3382cc06d82596f8eb98e0806f3abe1e79155fafd46da2a8b746bfbe'
        'SKIP')

validpgpkeys=(4EF4AC63455FC9F4545D9B7DEF8FE99528B52FFD)

build() {

  cd "${srcdir:?}/zstd-${pkgver}" || (
    echo -e "\E[1;31mCan't cd to ${srcdir:?}/zstd-${pkgver} directory! Build Failed! \E[0m"
    exit 1
  )

  make

  make -C contrib/pzstd

}

check() {

  cd "${srcdir:?}/zstd-${pkgver}" || (
    echo -e "\E[1;31mCan't cd to ${srcdir:?}/zstd-${pkgver} directory! Check Failed! \E[0m"
    exit 1
  )

  make check

  make -C contrib/pzstd test

}

package() {

  cd "${srcdir:?}/zstd-${pkgver}" || (
    echo -e "\E[1;31mCan't cd to ${srcdir:?}/zstd-${pkgver} directory! Check Failed! \E[0m"
    exit 1
  )

  make DESTDIR="${pkgdir:?}" PREFIX=/usr install
  ln -sf /usr/bin/zstd "${pkgdir:?}/usr/bin/zstdmt"
  install -Dm 755 contrib/pzstd/pzstd -t "${pkgdir:?}/usr/bin"
  install -Dm 644 LICENSE -t "${pkgdir:?}/usr/share/licenses/${pkgname}"

}
